{%- liquid
  assign hero_height = section.settings.height | default: 'full'
  assign show_overlay = section.settings.show_overlay | default: true
-%}

<section class="hero hero--{{ hero_height }}" data-hero>
  {%- if section.blocks.size > 0 -%}
    {%- for block in section.blocks -%}
      <div class="hero__slide {% if forloop.first %}is-active{% endif %}" {{ block.shopify_attributes }}>
        <div class="hero__media">
          {%- if block.settings.video != blank -%}
            {{ block.settings.video | video_tag: autoplay: true, loop: true, muted: true, playsinline: true, class: 'hero__video' }}
          {%- elsif block.settings.image != blank -%}
            <img 
              src="{{ block.settings.image | image_url: width: 1920 }}"
              srcset="{{ block.settings.image | image_url: width: 800 }} 800w,
                      {{ block.settings.image | image_url: width: 1200 }} 1200w,
                      {{ block.settings.image | image_url: width: 1920 }} 1920w"
              sizes="100vw"
              alt="{{ block.settings.heading | escape }}"
              loading="{% if forloop.first %}eager{% else %}lazy{% endif %}"
              class="hero__image"
              fetchpriority="{% if forloop.first %}high{% else %}auto{% endif %}"
            >
          {%- else -%}
            <!-- Fallback: Fashion model photo from Unsplash -->
            <img 
              src="https://images.unsplash.com/photo-1469334031218-e382a71b716b?w=1920&q=80&fit=crop"
              alt="{{ block.settings.heading | default: 'Spring Collection' | escape }}"
              loading="eager"
              class="hero__image"
              fetchpriority="high"
            >
          {%- endif -%}
        </div>

        {%- if show_overlay -%}
          <div class="hero__overlay"></div>
        {%- endif -%}

        <div class="hero__content">
          {%- if block.settings.subheading != blank -%}
            <p class="hero__subheading">{{ block.settings.subheading }}</p>
          {%- elsif forloop.first -%}
            <p class="hero__subheading">New Collection</p>
          {%- endif -%}
          
          {%- if block.settings.heading != blank -%}
            <h1 class="hero__heading">{{ block.settings.heading }}</h1>
          {%- elsif forloop.first -%}
            <h1 class="hero__heading">Work Wardrobe<br>Spring 26</h1>
          {%- endif -%}
          
          {%- if block.settings.button_label != blank -%}
            <a href="{{ block.settings.button_link | default: '/collections/all' }}" class="hero__cta btn btn--primary">
              {{ block.settings.button_label }}
            </a>
          {%- elsif forloop.first -%}
            <a href="/collections/all" class="hero__cta btn btn--primary">Shop Now</a>
          {%- endif -%}
        </div>
      </div>
    {%- endfor -%}
  {%- else -%}
    <!-- Default hero when no blocks configured -->
    <div class="hero__slide is-active">
      <div class="hero__media">
        <img 
          src="https://images.unsplash.com/photo-1469334031218-e382a71b716b?w=1920&q=80&fit=crop"
          alt="Work Wardrobe Spring 26"
          loading="eager"
          class="hero__image"
          fetchpriority="high"
        >
      </div>
      <div class="hero__overlay"></div>
      <div class="hero__content">
        <p class="hero__subheading">New Collection</p>
        <h1 class="hero__heading">Work Wardrobe<br>Spring 26</h1>
        <a href="/collections/all" class="hero__cta btn btn--primary">Shop Now</a>
      </div>
    </div>
  {%- endif -%}

  <!-- Slideshow Controls -->
  {%- if section.blocks.size > 1 -%}
    <div class="hero__controls">
      <button class="hero__pause" type="button" aria-label="Pause slideshow" data-pause-btn>
        <svg class="icon-pause" xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="currentColor">
          <rect x="6" y="4" width="4" height="16"/>
          <rect x="14" y="4" width="4" height="16"/>
        </svg>
        <svg class="icon-play" xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="currentColor" style="display:none;">
          <polygon points="5 3 19 12 5 21 5 3"/>
        </svg>
      </button>
    </div>
    
    <!-- Slide Indicators -->
    <div class="hero__indicators">
      {%- for block in section.blocks -%}
        <button 
          class="hero__indicator {% if forloop.first %}is-active{% endif %}" 
          type="button" 
          aria-label="Go to slide {{ forloop.index }}"
          data-slide="{{ forloop.index0 }}"
        ></button>
      {%- endfor -%}
    </div>
  {%- else -%}
    <div class="hero__controls">
      <button class="hero__pause" type="button" aria-label="Pause slideshow" style="visibility: hidden;">
        <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="currentColor">
          <rect x="6" y="4" width="4" height="16"/>
          <rect x="14" y="4" width="4" height="16"/>
        </svg>
      </button>
    </div>
  {%- endif -%}
</section>

<style>
.hero {
  position: relative;
  width: 100%;
  height: 100vh;
  min-height: 600px;
  overflow: hidden;
  margin-top: 0;
}

.hero__slide {
  position: absolute;
  inset: 0;
  opacity: 0;
  visibility: hidden;
  transition: opacity 0.8s ease, visibility 0.8s;
  z-index: 1;
}

.hero__slide.is-active {
  opacity: 1;
  visibility: visible;
  z-index: 2;
}

.hero__media {
  position: absolute;
  inset: 0;
}

.hero__image,
.hero__video {
  width: 100%;
  height: 100%;
  object-fit: cover;
  object-position: center;
}

.hero__overlay {
  position: absolute;
  inset: 0;
  background: linear-gradient(
    to bottom,
    rgba(0,0,0,0.15) 0%,
    rgba(0,0,0,0) 30%,
    rgba(0,0,0,0) 50%,
    rgba(0,0,0,0.4) 100%
  );
  pointer-events: none;
}

.hero__content {
  position: absolute;
  bottom: 100px;
  left: 40px;
  right: 40px;
  color: #fff;
  z-index: 10;
}

@media (min-width: 768px) {
  .hero__content {
    bottom: 120px;
    left: 60px;
    max-width: 600px;
  }
}

.hero__subheading {
  font-family: var(--font-body);
  font-size: 11px;
  font-weight: 500;
  letter-spacing: 0.15em;
  text-transform: uppercase;
  margin-bottom: 16px;
  opacity: 0.9;
}

.hero__heading {
  font-family: var(--font-heading);
  font-size: 40px;
  font-weight: 300;
  line-height: 1.1;
  margin-bottom: 28px;
  letter-spacing: -0.01em;
}

@media (min-width: 768px) {
  .hero__heading {
    font-size: 56px;
  }
}

@media (min-width: 1024px) {
  .hero__heading {
    font-size: 64px;
  }
}

.hero__cta {
  display: inline-block;
  font-family: var(--font-body);
  font-size: 12px;
  font-weight: 500;
  letter-spacing: 0.1em;
  text-transform: uppercase;
  color: #fff;
  padding: 14px 32px;
  border: 1px solid #fff;
  background: transparent;
  transition: all 0.3s ease;
  cursor: pointer;
}

.hero__cta:hover {
  background: #fff;
  color: #000;
}

/* Hero Controls */
.hero__controls {
  position: absolute;
  bottom: 40px;
  right: 40px;
  z-index: 20;
}

.hero__pause {
  width: 44px;
  height: 44px;
  border: 1px solid rgba(255,255,255,0.5);
  border-radius: 50%;
  display: flex;
  align-items: center;
  justify-content: center;
  color: #fff;
  background: transparent;
  transition: all 0.3s ease;
  cursor: pointer;
}

.hero__pause:hover {
  background: rgba(255,255,255,0.15);
  border-color: #fff;
}

.hero__pause.is-paused .icon-pause { display: none; }
.hero__pause.is-paused .icon-play { display: block !important; }

/* Slide Indicators */
.hero__indicators {
  position: absolute;
  bottom: 40px;
  left: 50%;
  transform: translateX(-50%);
  display: flex;
  gap: 12px;
  z-index: 20;
}

.hero__indicator {
  width: 8px;
  height: 8px;
  border-radius: 50%;
  border: 1px solid rgba(255,255,255,0.6);
  background: transparent;
  cursor: pointer;
  transition: all 0.3s ease;
  padding: 0;
}

.hero__indicator:hover {
  border-color: #fff;
}

.hero__indicator.is-active {
  background: #fff;
  border-color: #fff;
}
</style>

<script>
(function() {
  const hero = document.querySelector('[data-hero]');
  if (!hero) return;

  const slides = hero.querySelectorAll('.hero__slide');
  const pauseBtn = hero.querySelector('[data-pause-btn]');
  const indicators = hero.querySelectorAll('.hero__indicator');
  
  if (slides.length <= 1) return;

  let currentSlide = 0;
  let isPaused = false;
  let interval;
  const speed = {{ section.settings.autoplay_speed | default: 5 }} * 1000;

  function showSlide(index) {
    slides.forEach((slide, i) => {
      slide.classList.toggle('is-active', i === index);
    });
    indicators.forEach((ind, i) => {
      ind.classList.toggle('is-active', i === index);
    });
    currentSlide = index;
  }

  function nextSlide() {
    showSlide((currentSlide + 1) % slides.length);
  }

  function startAutoplay() {
    if (isPaused) return;
    interval = setInterval(nextSlide, speed);
  }

  function stopAutoplay() {
    clearInterval(interval);
  }

  // Pause button
  if (pauseBtn) {
    pauseBtn.addEventListener('click', function() {
      isPaused = !isPaused;
      this.classList.toggle('is-paused', isPaused);
      this.setAttribute('aria-label', isPaused ? 'Play slideshow' : 'Pause slideshow');
      if (isPaused) {
        stopAutoplay();
      } else {
        startAutoplay();
      }
    });
  }

  // Indicators
  indicators.forEach((indicator, index) => {
    indicator.addEventListener('click', function() {
      stopAutoplay();
      showSlide(index);
      startAutoplay();
    });
  });

  // Start autoplay if enabled
  {% if section.settings.autoplay %}
    startAutoplay();
  {% endif %}

  // Pause on hover (optional UX improvement)
  hero.addEventListener('mouseenter', stopAutoplay);
  hero.addEventListener('mouseleave', function() {
    if (!isPaused) startAutoplay();
  });
})();
</script>

{% schema %}
{
  "name": "Hero Banner",
  "tag": "section",
  "class": "section-hero",
  "settings": [
    {
      "type": "select",
      "id": "height",
      "label": "Height",
      "options": [
        { "value": "full", "label": "Full screen" },
        { "value": "large", "label": "Large" },
        { "value": "medium", "label": "Medium" }
      ],
      "default": "full"
    },
    {
      "type": "checkbox",
      "id": "show_overlay",
      "label": "Show overlay",
      "default": true
    },
    {
      "type": "checkbox",
      "id": "autoplay",
      "label": "Auto-rotate slides",
      "default": true
    },
    {
      "type": "range",
      "id": "autoplay_speed",
      "min": 3,
      "max": 10,
      "step": 1,
      "unit": "s",
      "label": "Change slides every",
      "default": 5
    }
  ],
  "blocks": [
    {
      "type": "slide",
      "name": "Slide",
      "settings": [
        {
          "type": "image_picker",
          "id": "image",
          "label": "Image"
        },
        {
          "type": "video",
          "id": "video",
          "label": "Video"
        },
        {
          "type": "text",
          "id": "subheading",
          "label": "Subheading",
          "default": "New Collection"
        },
        {
          "type": "text",
          "id": "heading",
          "label": "Heading",
          "default": "Work Wardrobe Spring 26"
        },
        {
          "type": "text",
          "id": "button_label",
          "label": "Button label",
          "default": "Shop Now"
        },
        {
          "type": "url",
          "id": "button_link",
          "label": "Button link"
        }
      ]
    }
  ],
  "presets": [
    {
      "name": "Hero Banner",
      "blocks": [
        {
          "type": "slide",
          "settings": {
            "subheading": "New Collection",
            "heading": "Work Wardrobe Spring 26",
            "button_label": "Shop Now"
          }
        }
      ]
    }
  ]
}
{% endschema %}
