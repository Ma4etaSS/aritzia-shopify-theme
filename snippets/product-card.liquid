{%- comment -%}
  Aritzia-style Product Card
  
  Accepts:
  - product: {Object} Product object
  - show_vendor: {Boolean} Show vendor name
  - show_secondary_image: {Boolean} Show secondary image on hover
  - show_quick_add: {Boolean} Show quick add button
  - image_ratio: {String} Image aspect ratio (portrait, square, landscape)
  - lazy_load: {Boolean} Lazy load images
  
  Usage:
  {% render 'product-card', product: product %}
{%- endcomment -%}

{%- liquid
  assign show_vendor = show_vendor | default: false
  assign show_secondary_image = show_secondary_image | default: true
  assign show_quick_add = show_quick_add | default: true
  assign image_ratio = image_ratio | default: 'portrait'
  assign lazy_load = lazy_load | default: true
  
  assign on_sale = false
  if product.compare_at_price > product.price
    assign on_sale = true
  endif
  
  assign sold_out = false
  unless product.available
    assign sold_out = true
  endunless
-%}

<article class="product-card" data-product-card>
  {% comment %} Product Image {% endcomment %}
  <div class="product-card__media aspect-{{ image_ratio }}">
    <a href="{{ product.url }}" class="product-card__link" aria-label="{{ product.title | escape }}">
      {%- if product.featured_media -%}
        <img
          src="{{ product.featured_media | image_url: width: 600 }}"
          srcset="{{ product.featured_media | image_url: width: 300 }} 300w, {{ product.featured_media | image_url: width: 600 }} 600w, {{ product.featured_media | image_url: width: 800 }} 800w"
          alt="{{ product.featured_media.alt | default: product.title | escape }}"
          loading="{% if lazy_load %}lazy{% else %}eager{% endif %}"
          width="{{ product.featured_media.width }}"
          height="{{ product.featured_media.height }}"
          class="product-card__image product-card__image--primary"
        >
        {%- if show_secondary_image and product.media[1] -%}
          <img
            src="{{ product.media[1] | image_url: width: 600 }}"
            srcset="{{ product.media[1] | image_url: width: 300 }} 300w, {{ product.media[1] | image_url: width: 600 }} 600w, {{ product.media[1] | image_url: width: 800 }} 800w"
            alt="{{ product.media[1].alt | default: product.title | escape }}"
            loading="lazy"
            width="{{ product.media[1].width }}"
            height="{{ product.media[1].height }}"
            class="product-card__image product-card__image--secondary"
          >
        {%- endif -%}
      {%- else -%}
        <div class="product-card__placeholder">
          {{ 'product-1' | placeholder_svg_tag: 'product-card__placeholder-svg' }}
        </div>
      {%- endif -%}
    </a>

    {% comment %} Badges {% endcomment %}
    <div class="product-card__badges">
      {%- if on_sale -%}
        <span class="product-card__badge product-card__badge--sale">Sale</span>
      {%- endif -%}
      {%- if sold_out -%}
        <span class="product-card__badge product-card__badge--sold-out">Sold Out</span>
      {%- endif -%}
    </div>

    {% comment %} Wishlist Button {% endcomment %}
    <button type="button" class="product-card__wishlist" aria-label="Add to wishlist" data-wishlist-add>
      {% render 'icon-heart' %}
    </button>

    {% comment %} Quick Add {% endcomment %}
    {%- if show_quick_add and product.available -%}
      <div class="product-card__quick-add">
        {%- if product.variants.size == 1 -%}
          <form method="post" action="/cart/add" class="product-card__form">
            <input type="hidden" name="id" value="{{ product.variants.first.id }}">
            <button type="submit" class="product-card__add-btn btn btn-primary">
              Add to Cart
            </button>
          </form>
        {%- else -%}
          <a href="{{ product.url }}" class="product-card__add-btn btn btn-primary">
            Select Options
          </a>
        {%- endif -%}
      </div>
    {%- endif -%}
  </div>

  {% comment %} Product Info {% endcomment %}
  <div class="product-card__info">
    {%- if show_vendor and product.vendor -%}
      <p class="product-card__vendor">{{ product.vendor }}</p>
    {%- endif -%}
    
    <h3 class="product-card__title">
      <a href="{{ product.url }}">{{ product.title }}</a>
    </h3>

    {% comment %} Color Swatches {% endcomment %}
    {%- assign color_option = product.options_by_name['Color'] -%}
    {%- if color_option and color_option.values.size > 1 -%}
      <div class="product-card__swatches">
        {%- for color in color_option.values limit: 5 -%}
          {%- assign color_handle = color | handleize -%}
          <span 
            class="product-card__swatch"
            style="background-color: {{ color_handle }};"
            title="{{ color }}"
          ></span>
        {%- endfor -%}
        {%- if color_option.values.size > 5 -%}
          <span class="product-card__swatch-more">+{{ color_option.values.size | minus: 5 }}</span>
        {%- endif -%}
      </div>
    {%- endif -%}

    {% comment %} Price {% endcomment %}
    <div class="product-card__price">
      {% render 'price', product: product %}
    </div>
  </div>
</article>
